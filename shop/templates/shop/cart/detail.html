{% extends "base.html" %}
{% load static %}

{% block title %}Корзина покупок{% endblock %}

{% block content %}
<h1>Ваша корзина</h1>

{% if cart %}
<table class="table table-striped">
    <thead>
        <tr>
            <th>Товар</th>
            <th>Количество</th>
            <th>Цена за шт.</th>
            <th>Общая цена</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        {% for item in cart %}
        <tr>
            <td>{{ item.product.name }}</td>
            <td>
                <form action="{% url 'shop:cart_add' item.product.id %}" method="post" class="d-inline">
                    {% csrf_token %}
                    {{ item.update_quantity_form.quantity }}
                    {{ item.update_quantity_form.override }}
                    <button type="submit" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-sync"></i>
                    </button>
                </form>
            </td>
            <td>{{ item.price }} руб.</td>
            <td>{{ item.total_price }} руб.</td>
            <td>
                <form action="{% url 'shop:cart_remove' item.product.id %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm">
                        <i class="fas fa-trash"></i> Удалить
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr>
            <td colspan="3"><strong>Итого:</strong></td>
            <td colspan="2"><strong>{{ cart.get_total_price }} руб.</strong></td>
        </tr>
    </tfoot>
</table>

<div class="d-flex justify-content-between">
    <a href="{% url 'shop:product_list' %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Продолжить покупки
    </a>
    <a href="{% url 'shop:order_create' %}" class="btn btn-success">
        <i class="fas fa-check"></i> Оформить заказ
    </a>
</div>

{% else %}
<div class="alert alert-info">
    <i class="fas fa-info-circle"></i> Ваша корзина пуста.
</div>
<a href="{% url 'shop:product_list' %}" class="btn btn-primary">
    <i class="fas fa-store"></i> Перейти к покупкам
</a>
{% endif %}
{% block extra_js %}
<script src="{% static 'shop/js/cart.js' %}"></script>
{% endblock %}